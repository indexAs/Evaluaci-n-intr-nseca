<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Evaluación básica para detectar la pérdida de capacidad intrínseca</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  background:#f4f6f8;
  padding:20px;
}
.container{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
h1{text-align:center;margin-bottom:30px;}
h2{margin-bottom:10px;}
.seccion{margin-bottom:10px;}
label{display:block;margin:4px 0;}
input, select{padding:6px;margin-top:5px;}
button{
  background:#2b6cb0;
  color:white;
  border:none;
  padding:12px 25px;
  border-radius:25px;
  cursor:pointer;
  margin-top:20px;
}
.botones{
  display:flex;
  justify-content:space-between;
}
.resultado{
  background:#edf2f7;
  padding:20px;
  border-radius:10px;
  margin-top:30px;
}
.pantalla{display:none;}
.pantalla.activa{display:block;}
</style>
</head>

<body>
<div class="container">
<h1>Evaluación básica para detectar la pérdida de capacidad intrínseca</h1>

<!-- ================= DATOS PACIENTE ================= -->
<div id="p0" class="pantalla activa">
<h2>Datos del paciente</h2>
<label>Nombre completo:
<input type="text" id="nombre">
</label>
<label>Edad:
<input type="number" id="edad">
</label>
<label>Sexo:
<select id="sexo">
<option value="">Seleccione</option>
<option value="Femenino">Femenino</option>
<option value="Masculino">Masculino</option>
</select>
</label>
<div class="botones">
<button onclick="mostrar(1)">Comenzar evaluación</button>
</div>
</div>

<!-- DOMINIOS -->

<div id="p1" class="pantalla">
<h2>Deterioro cognitivo (Cognición)</h2>
<div class="seccion">
<b>Pregunta de filtro:</b><br>
¿Tiene algún problema de memoria o de orientación (como no saber dónde está o qué día es)?
</div>
<div class="seccion">
<b>Pruebas:</b><br>
1. Recordar tres palabras.<br>
2. Orientación en tiempo y espacio.<br>
• ¿Cuál es la fecha completa de hoy?<br>
• ¿Dónde está usted ahora mismo?<br>
• ¿Recuerda las tres palabras?
</div>
<label><input type="radio" name="cognicion" value="superada"> Superada</label>
<label><input type="radio" name="cognicion" value="no"> No superada</label>
<div class="botones">
<button onclick="mostrar(0)">Anterior</button>
<button onclick="mostrar(2)">Siguiente</button>
</div>
</div>

<div id="p2" class="pantalla">
<h2>Movilidad limitada</h2>
<div class="seccion">
Levantarse de la silla cinco veces sin usar los brazos.<br>
¿Se levantó cinco veces en ≤ 14 segundos?
</div>
<label><input type="radio" name="movilidad" value="superada"> Sí</label>
<label><input type="radio" name="movilidad" value="no"> No</label>
<div class="botones">
<button onclick="mostrar(1)">Anterior</button>
<button onclick="mostrar(3)">Siguiente</button>
</div>
</div>

<div id="p3" class="pantalla">
<h2>Nutrición deficiente</h2>
<div class="seccion">
¿Ha perdido involuntariamente más de 3 kg en los últimos 3 meses?
</div>
<div class="seccion">
¿Ha tenido falta de apetito?
</div>
<label><input type="radio" name="nutricion" value="superada"> Respuesta negativa a ambas preguntas</label>
<label><input type="radio" name="nutricion" value="no"> Respuesta afirmativa a alguna</label>
<div class="botones">
<button onclick="mostrar(2)">Anterior</button>
<button onclick="mostrar(4)">Siguiente</button>
</div>
</div>

<div id="p4" class="pantalla">
<h2>Deficiencia visual</h2>
<div class="seccion">
¿Tiene algún problema en los ojos?
</div>
<label><input type="radio" name="vision" value="superada"> Superada</label>
<label><input type="radio" name="vision" value="no"> No superada</label>
<div class="botones">
<button onclick="mostrar(3)">Anterior</button>
<button onclick="mostrar(5)">Siguiente</button>
</div>
</div>

<div id="p5" class="pantalla">
<h2>Pérdida auditiva</h2>
<div class="seccion">
¿Tiene dificultades para oír?
</div>
<label><input type="radio" name="audicion" value="superada"> Superada</label>
<label><input type="radio" name="audicion" value="no"> No superada</label>
<div class="botones">
<button onclick="mostrar(4)">Anterior</button>
<button onclick="mostrar(6)">Siguiente</button>
</div>
</div>

<div id="p6" class="pantalla">
<h2>Síntomas depresivos</h2>
<div class="seccion">
En las últimas 2 semanas, ¿ha tenido tristeza o poco interés?
</div>
<label><input type="radio" name="depresion" value="superada"> Respuesta negativa a ambas</label>
<label><input type="radio" name="depresion" value="no"> Respuesta afirmativa a alguna</label>
<div class="botones">
<button onclick="mostrar(5)">Anterior</button>
<button onclick="calcular()">Calcular resultado</button>
</div>
</div>

<!-- RESULTADOS -->
<div id="p7" class="pantalla">
<h2>Resultado de la evaluación</h2>
<div id="resContenido" class="resultado"></div>
<button onclick="enviarDatos()">Finalizar y enviar a la hoja</button>
<button onclick="reiniciar()">Nueva evaluación</button>
</div>

</div>

<script>

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyMmUPgu8EpQ_ObeYAFwNzbJxuGkK7S7_3JZWnRiwXrFTiMAXzT3EfFXPlYzZhDn98b/exec";

function mostrar(num){
  document.querySelectorAll(".pantalla").forEach(p=>p.classList.remove("activa"));
  document.getElementById("p"+num).classList.add("activa");
}

function valor(nombre){
  let r = document.querySelector(`input[name="${nombre}"]:checked`);
  return r ? r.value : "";
}

function calcular(){

  const nombre = document.getElementById("nombre").value;
  const edad = document.getElementById("edad").value;
  const sexo = document.getElementById("sexo").value;

  let dominios=["cognicion","movilidad","nutricion","vision","audicion","depresion"];
  let noSuperadas=0;
  let detalle="";

  dominios.forEach(d=>{
    let v=valor(d);
    if(v==="no"){
      noSuperadas++;
      detalle+= d.toUpperCase()+" no superada<br>";
    }else{
      detalle+= d.toUpperCase()+" superada<br>";
    }
  });

  let conclusion=noSuperadas===0
    ? "Capacidad intrínseca conservada"
    : "Posible deterioro en uno o más dominios";

  document.getElementById("resContenido").innerHTML =
    "<b>Paciente:</b> "+nombre+"<br>"+
    "<b>Edad:</b> "+edad+"<br>"+
    "<b>Sexo:</b> "+sexo+"<br><br>"+
    detalle+"<br><h3>"+conclusion+"</h3>";

  mostrar(7);
}

function enviarDatos(){

  const data = {
    nombre: document.getElementById("nombre").value,
    edad: document.getElementById("edad").value,
    sexo: document.getElementById("sexo").value,
    cognicion_resultado: valor("cognicion"),
    movilidad_resultado: valor("movilidad"),
    nutricion_resultado: valor("nutricion"),
    vision_resultado: valor("vision"),
    audicion_resultado: valor("audicion"),
    depresion_resultado: valor("depresion"),
    resultado_final: document.getElementById("resContenido").innerText
  };

  fetch(SCRIPT_URL,{
    method:"POST",
    mode:"no-cors",
    body: JSON.stringify(data)
  })
  .then(()=>{
    alert("Datos enviados correctamente");
    reiniciar();
  })
  .catch(err=>{
    alert("Error al enviar datos");
    console.error(err);
  });
}

function reiniciar(){
  document.querySelectorAll("input[type=radio]").forEach(i=>i.checked=false);
  document.getElementById("nombre").value="";
  document.getElementById("edad").value="";
  document.getElementById("sexo").value="";
  mostrar(0);
}

</script>

</body>
</html>
